import os
from unittest.mock import MagicMock

import pytest
from fastapi.testclient import TestClient

from app.main import app


# Set environment variables for testing
@pytest.fixture(scope="session", autouse=True)
def setup_test_environment():
    """Setup test environment variables"""
    # Blockchain Local(DOCKER) Env
    os.environ["BLOCKCHAIN_RPC_URL"] = "http://127.0.0.1:3050"
    os.environ["BLOCKCHAIN_WALLET_PRVT_KEY"] = (
        "0x7726827caac94a7f9e1b160f7ea819f172f7b6f9d2a97f992c38edeab82d4110"
    )
    os.environ["BLOCKCHAIN_WALLET_ADDR"] = "0x36615Cf349d7F6344891B1e7CA7C72883F5dc049"
    os.environ["ZKSYNC_NODE_TYPE"] = "dockerizedNode"
    os.environ["BLOCKCHAIN_CHAIN_ID"] = "270"

    # Supabase Local(DOCKER) Env
    os.environ["SUPABASE_URL"] = "http://127.0.0.1:54321"
    os.environ["SUPABASE_AUTH_ANON_KEY"] = (
        "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZS1kZW1vIiwicm9sZSI6ImFub24iLCJleHAiOjE5ODM4MTI5OTZ9.CRXP1A7WOeoJeXxjNni43kdQwgnWNReilDMblYTn_I0"
    )
    os.environ["SUPABASE_AUTH_SERV_KEY"] = (
        "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZS1kZW1vIiwicm9zZSI6InNlcnZpY2Vfcm9sZSIsImV4cCI6MTk4MzgxMjk5Nn0.EGIM96RAZx35lJzdJsyH-qQwv8Hdp7fsn3W0YpN81IU"
    )
    os.environ["SUPABASE_AUTH_JWT_SECRET"] = (
        "super-secret-jwt-token-with-at-least-32-characters-long"
    )
    os.environ["SUPABASE_DB_URL"] = (
        "postgresql://postgres:postgres@127.0.0.1:54322/postgres"
    )

    # Additional configuration
    os.environ["SUPABASE_JWT_ALGORITHM"] = "HS256"
    os.environ["SUPABASE_JWT_EXPIRES"] = "3600"
    os.environ["CRED_SERVER_URL"] = "http://127.0.0.1:5000"
    os.environ["DEBUG"] = "0"
    os.environ["ACC_MODULUS"] = (
        "448514647149538630209144019772989324770279973764706800669427283016299015113854383854015736722074147957353106355667596323850455953439345350650706073242275869211968354896998172364306091092652622130861928310359580982280236867993433801413723326150738723392320111808771290119539024699300436229708396795194333063763582879422200971616302853005765171385855182779816962163299135337888818364430497932620072760230879023124758459171358435317332068359552961739818497108343508879153826631077014515916813067912940543809532245536443335432015922804150075785688892152915180427926208131028368138352246512408516033480202819079723951869533329066882846374603618433641086910284042562958598356231538331537058478081372266809918937193882507640952411351183557482435164062319645623095043560269804999187852531876036286493417658435642955497355040104296629665024838104576981868758509208458802612840502255691520769507510097316593666229247380699590947628451"
    )
    os.environ["ACC_GENERATOR"] = (
        "2445015175015606500258660207490260990375109748916884809008333471122678695480269838567092847364083390235182321439078595958268364495587208310569833433637443849249669993121443010361551631628182129728587167687621549820805710710220040820673872395199182504910568828965625723729879421577905832838065162088576183451979211659074617154877186332729029073861357955850109861949507086644591612123289205326973831611790274259317092778169861305739524038516361387833526247715016021980704510279072140757891719531195490251850111254618234411363546990809533339123394756409502842118976217282956811347357661303673796507084966882518087251025672563261175452626120707055623806762624693048630940493645895351510234354971089518711287051221678505552985480251516519180663911779576564013213526410365319007919827250237835851982921455686668976996430300494940848313243258826783822222931623536368332856493547321908871020716282602368655102141135727293779942869533"
    )


@pytest.fixture
def client():
    """Create a test client for the FastAPI app."""
    return TestClient(app)


@pytest.fixture
def mock_supabase():
    """Mock Supabase client for testing."""
    return MagicMock()


@pytest.fixture
def mock_database():
    """Mock database for testing."""
    return MagicMock()


# @pytest.fixture
# def mock_verify_jwt():
#     """Mock JWT verification for testing."""
#     return MagicMock()
